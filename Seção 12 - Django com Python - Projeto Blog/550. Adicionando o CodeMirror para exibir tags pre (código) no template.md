# Passo a passo — Como renderizar trechos de código (CodeMirror) no seu blog

1. **Coloque o código dentro de `<pre>` sem espaços extras**

   * Formate o HTML no VSCode (Format Document) e **remova linhas vazias** no começo/fim.
   * Exemplo:

     ```html
     <pre data-language="python">
     def soma(a, b):
         return a + b
     </pre>
     ```
   * Use `data-language` com um dos nomes: `python`, `javascript`, `htmlmixed`, `css`, `xml`.

2. **Inclua os arquivos do CodeMirror no `<head>` (apenas onde precisar)**

   * No `base.html` crie um bloco onde você possa injetar CSS/JS extra:

     ```django
     <!-- base.html -->
     <head>
       ...
       {% block additional_head %}{% endblock %}
     </head>
     ```
   * No template de post (`post.html`) preencha esse bloco com os assets do CodeMirror:

     ```django
     {% block additional_head %}
     <link rel="stylesheet" href=".../codemirror.css">
     <link rel="stylesheet" href=".../theme/dracula.css">
     <script src=".../codemirror.js"></script>
     <script src=".../mode/python/python.js"></script>
     <script src=".../mode/javascript/javascript.js"></script>
     <script src=".../mode/htmlmixed/htmlmixed.js"></script>
     <script src=".../mode/xml/xml.js"></script>
     <script src=".../mode/css/css.js"></script>
     {% endblock %}
     ```
   * **Obs:** coloque os `<script>`/`<link>` só no template do post (ou via bloco) para *não* carregar CodeMirror nas páginas que não usam código.

3. **Adicione o script que transforma `<pre>` em CodeMirror (footer)**

   * Coloque este script logo antes de `</body>` (p.ex. no include de footer ou no final do `post.html`):

     ```html
     <script>
     (function(){
       if (typeof CodeMirror === 'undefined') return;
       document.querySelectorAll('pre[data-language]').forEach(pre => {
         const lang = pre.dataset.language || null;
         const code = pre.textContent.trim();
         const container = document.createElement('div');
         const editor = CodeMirror(container, {
           value: code,
           mode: lang,
           theme: 'dracula',
           readOnly: true,
           lineNumbers: true,
           tabSize: 2,
           viewportMargin: Infinity // mostra todo o código sem lazy rendering interno
         });
         pre.parentNode.replaceChild(container, pre);
       });
     })();
     </script>
     ```
   * Esse script cria editores somente onde há `<pre data-language="...">`.

4. **Ajuste estilo (CSS) do CodeMirror para ficar do tamanho/visual que você quer**

   * Exemplo mínimo (coloque no seu CSS global):

     ```css
     .CodeMirror { 
       max-height: 400px;         /* limite de altura */
       height: auto !important;   /* permite ajuste automático */
       font-family: var(--ff-mono, monospace) !important;
       font-size: 1.4rem !important;
     }
     ```
   * Use `!important` somente quando necessário (algumas folhas do CodeMirror têm prioridade).

5. **Cuidados com o HTML gerado pelo editor (SummerNote etc.)**

   * Confirme no *Code View* do editor que a tag `<pre>` ficou limpa (sem `style` inline, `br` desnecessário).
   * Se o editor inserir `style="width:..."` em imagens ou tags indesejadas, remova manualmente no *Code View*.

6. **Nomes válidos para `data-language`**

   * Use exatamente os nomes dos modos carregados: `python`, `javascript`, `htmlmixed`, `css`, `xml` (ou outros modos que você incluiu).

7. **Não carregue CodeMirror desnecessariamente**

   * Colocando os assets no bloco `additional_head` do **post** você evita baixar arquivos nas páginas que não usam código (home, listagens, etc.).

---

Pronto — com isso você:

* copia/cola trechos de código no admin (ou no conteúdo),
* marca `<pre data-language="...">`,
* injeta os assets apenas no template do post,
* e o JS converte automaticamente em visual bonito e legível com CodeMirror.

Quer que eu gere para você um **snippet pronto** (assets + script + CSS) já formatado para colar no seu `base.html` e `post.html`?
