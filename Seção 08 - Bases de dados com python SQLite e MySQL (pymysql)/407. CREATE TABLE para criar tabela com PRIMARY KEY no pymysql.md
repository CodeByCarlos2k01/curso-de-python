# Passo a passo — testar conexão e **criar tabela** com Python + MySQL (super direto)

1. **Confirme que a conexão funciona**

   * Teste rápido: `SELECT 1` via seu script ou cliente (DBeaver).
   * Se `Connection refused` → Docker/container parado; inicie-o.

2. **Abra a conexão usando `with` (auto-fecha)**

   ```python
   import pymysql
   from pymysql.cursors import DictCursor

   conn = pymysql.connect(
       host=HOST, port=PORT, user=USER, password=PWD,
       database=DB, charset="utf8mb4", cursorclass=DictCursor
   )
   ```

3. **Crie a tabela (com `IF NOT EXISTS` para evitar erro se já existir)**

   ```python
   create_sql = """
   CREATE TABLE IF NOT EXISTS customers (
       id INT NOT NULL AUTO_INCREMENT,
       nome VARCHAR(50) NOT NULL,
       idade INT NOT NULL,
       PRIMARY KEY (id)
   );
   """

   with conn:
       with conn.cursor() as cur:
           cur.execute(create_sql)
       # conn.commit()  # opcional: alguns drivers/ambientes fazem commit automático ao sair do 'with'
   ```

   * `IF NOT EXISTS` impede erro na segunda execução.

4. **Commit / rollback**

   * Para `INSERT/UPDATE/DELETE` use `conn.commit()` (ou confie no `with conn:` se seu driver fizer commit automático).
   * Observação: em muitos ambientes DDL (CREATE) já gera commit automático, mas chamar `commit()` nunca atrapalha.

5. **Testar inserção e leitura (CRUD básico)**

   ```python
   with conn:
       with conn.cursor() as cur:
           cur.execute("INSERT INTO customers (nome, idade) VALUES (%s, %s)", ("Ana", 30))
           # conn.commit()

       with conn.cursor() as cur:
           cur.execute("SELECT * FROM customers;")
           print(cur.fetchall())
   ```

6. **Se ocorrer erro “table already exists”**

   * Use `CREATE TABLE IF NOT EXISTS ...` (como acima) OU remova a tabela no cliente (`DROP TABLE customers;`) se quiser recriar.

7. **Verificação visual (DBeaver / Workbench)**

   * Conecte-se ao DB e verifique se `customers` aparece em **Tables** e se as colunas (`id`, `nome`, `idade`) estão corretas.

8. **Boas práticas rápidas**

   * Normalmente tabelas e esquema são criados por DBAs — em produção você só faz CRUD no código.
   * Use `with conn:` e `with conn.cursor()` para fechar/limpar automaticamente.
   * Evite criar tabelas repetidamente no runtime; prefira migrações ou scripts de inicialização.

Pronto — com esses passos você testa a conexão, cria a tabela com segurança (sem erro ao rodar de novo) e faz inserts/queries básicos. Quer que eu gere um arquivo `init_db.py` pronto com esse fluxo?
