Aqui está a explicação simplificada em **passo a passo** para validar e redimensionar o favicon no Django:

---

# Passo a passo: Validar e redimensionar favicon no Django

1. **Criar validador para PNG**

   * Crie um módulo `utils/model_validators.py` e defina a função:

     ```python
     from django.core.exceptions import ValidationError

     def validate_png(img):
         if not img.name.lower().endswith('.png'):
             raise ValidationError("Imagem precisa ser PNG")
     ```

2. **Adicionar validador ao campo `favicon`**

   ```python
   from utils.model_validators import validate_png

   favicon = models.ImageField(
       upload_to='assets/favicon/%Y/%m/',
       blank=True,
       default='',
       validators=[validate_png]
   )
   ```

3. **Sobrescrever método `save` do model**

   * Permite executar ações antes/depois de salvar:

     ```python
     def save(self, *args, **kwargs):
         # Pega o favicon atual antes de salvar
         current_favicon_name = str(self.favicon.name)

         super().save(*args, **kwargs)  # salva no banco

         # Verifica se o favicon foi alterado
         if self.favicon and current_favicon_name != str(self.favicon.name):
             from utils.img import resize_image
             resize_image(self.favicon, new_width=32)  # redimensiona para 32x32
     ```

4. **Criar função para redimensionar imagens (`utils/img.py`)**

   ```python
   from PIL import Image
   from django.conf import settings
   import os

   def resize_image(image_field, new_width=32):
       img_path = os.path.join(settings.MEDIA_ROOT, image_field.name)
       img = Image.open(img_path)

       # Redimensiona proporcionalmente
       if img.width > new_width:
           new_height = int((new_width * img.height) / img.width)
           img = img.resize((new_width, new_height), Image.LANCZOS)
           img.save(img_path, quality=60)
   ```

5. **Verificar no template**

   * Exibir apenas se houver favicon:

     ```django
     {% if site_setup.favicon %}
         <link rel="icon" href="{{ site_setup.favicon.url }}" type="image/png">
     {% endif %}
     ```

6. **Fluxo completo**

   * Usuário envia imagem → valida se é PNG → salva no banco → se foi alterado, redimensiona para 32x32 → exibe nos templates.

---

Se você quiser, posso criar uma **versão final do model `SiteSetup` completo**, incluindo validação e redimensionamento do favicon, pronta para usar. Isso deixa tudo organizado de uma vez. Quer que eu faça?
