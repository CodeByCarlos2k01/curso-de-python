# Passo a passo — inserir/ler/atualizar/apagar (CRUD) com Python + MySQL (super direto)

1. **Confirme a conexão**

   * Rode um `SELECT 1` rápido para garantir que o DB responde.

   ```python
   with conn:
       with conn.cursor() as cur:
           cur.execute("SELECT 1;")
           print(cur.fetchone())
   ```

2. **Use `with conn:` (connection) e `with conn.cursor()` (cursor)** — fecha automaticamente e evita vazamento de conexões:

   ```python
   with conn:
       with conn.cursor() as cur:
           # comandos SQL aqui
   ```

3. **Criar tabela (só uma vez) — use `IF NOT EXISTS` para não dar erro em execuções repetidas**

   ```python
   create_sql = """
   CREATE TABLE IF NOT EXISTS customers (
       id INT NOT NULL AUTO_INCREMENT,
       nome VARCHAR(50) NOT NULL,
       idade INT NOT NULL,
       PRIMARY KEY (id)
   );
   """
   with conn:
       with conn.cursor() as cur:
           cur.execute(create_sql)
   ```

4. **Inserir uma linha (parametrizado)** — evita SQL injection; chame `conn.commit()` quando fizer mudanças (INSERT/UPDATE/DELETE):

   ```python
   insert_sql = "INSERT INTO customers (nome, idade) VALUES (%s, %s);"
   with conn:
       with conn.cursor() as cur:
           cur.execute(insert_sql, ("Luiz", 25))
           print("linhas afetadas:", cur.rowcount)
           print("last id:", cur.lastrowid)
       # commit automático ao sair do with conn em muitos drivers; senão chame conn.commit()
   ```

5. **Inserir vários (mais eficiente) — `executemany`**

   ```python
   data = [("Ana", 30), ("Pedro", 22), ("João", 40)]
   with conn:
       with conn.cursor() as cur:
           cur.executemany(insert_sql, data)
   ```

6. **Ler dados (SELECT)**

   ```python
   with conn:
       with conn.cursor() as cur:
           cur.execute("SELECT * FROM customers;")
           rows = cur.fetchall()
           print(rows)
   ```

7. **Atualizar / Apagar (UPDATE / DELETE)**

   ```python
   with conn:
       with conn.cursor() as cur:
           cur.execute("UPDATE customers SET idade=%s WHERE nome=%s", (26, "Luiz"))
           cur.execute("DELETE FROM customers WHERE nome=%s", ("João",))
   ```

8. **Limpar a tabela (TRUNCATE) — cuidado!**

   ```python
   with conn:
       with conn.cursor() as cur:
           cur.execute("TRUNCATE TABLE customers;")  # apaga tudo e reseta AUTO_INCREMENT
   ```

   * **AVISO:** não use em produção sem backup. `TRUNCATE` é destrutivo.

9. **Múltiplos cursores por conexão são permitidos**

   * Você pode abrir vários `cursor()` dentro do mesmo `with conn:` sem reconectar.
   * **Mas** não tente usar o cursor depois que a `connection` foi fechada — isso gera erro.

10. **Dica de desempenho / boas práticas rápidas**

    * Minimize “viagens” ao servidor: agrupe operações, use `executemany` para muitos inserts.
    * Use transações (commit uma vez no final) quando fizer várias operações relacionadas.
    * Não crie/altere esquema (tabelas) em runtime em produção — use migrações/scripts separados.
    * Sempre use queries parametrizadas (`%s`) — nunca concatene valores em strings SQL.

Pronto — com isso você já tem o fluxo CRUD básico, evita reconexões desnecessárias, e sabe quando usar `commit` e `TRUNCATE`. Quer que eu gere um `script` compacto (`init + inserts + selects`) pronto para colar no seu projeto?
