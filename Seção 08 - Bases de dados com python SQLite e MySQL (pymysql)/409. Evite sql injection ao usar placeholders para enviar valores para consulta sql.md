# Passo a passo — inserir dados com segurança (placeholders)

1. **Prepare a conexão** (use as variáveis do `.env`)

   ```python
   import pymysql
   conn = pymysql.connect(host=HOST, port=PORT, user=USER, password=PWD, database=DB,
                          charset="utf8mb4", cursorclass=pymysql.cursors.DictCursor)
   ```

2. **Nunca concatene valores no SQL** (evita SQL injection)
   — **Errado:**

   ```python
   sql = f"INSERT INTO customers (nome, idade) VALUES ('{nome}', {idade})"
   cur.execute(sql)
   ```

   — **Certo:** use placeholders (`%s`) e passe os valores separados.

3. **Montar a query com placeholders e passar os valores como tupla/lista**

   ```python
   insert_sql = "INSERT INTO customers (nome, idade) VALUES (%s, %s);"
   data = ("Luiz", 18)   # ordem = colunas
   ```

4. **Executar e confirmar (commit)**

   ```python
   try:
       with conn.cursor() as cur:
           cur.execute(insert_sql, data)
       conn.commit()   # confirma a alteração
   except Exception:
       conn.rollback() # desfaz se houver erro
       raise
   ```

5. **Inserir muitos registros de uma vez (mais rápido)**

   ```python
   data_list = [("Ana",30), ("Pedro",22), ("João",40)]
   with conn.cursor() as cur:
       cur.executemany(insert_sql, data_list)
   conn.commit()
   ```

6. **Verificar resultado / pegar ID gerado**

   ```python
   with conn.cursor() as cur:
       cur.execute("SELECT * FROM customers;")
       rows = cur.fetchall()
   print(rows)

   # last insert id & número de linhas afetadas
   with conn.cursor() as cur:
       cur.execute(insert_sql, ("Maria", 28))
       last_id = cur.lastrowid
       affected = cur.rowcount
   conn.commit()
   ```

7. **Boas práticas**

   * Agrupe várias operações em uma única transação e faça `commit()` no fim.
   * Use `executemany` para muitos inserts.
   * Não crie/altere esquemas (CREATE TABLE) no runtime de produção — use migrações.
   * Evite abrir/fechar conexões repetidamente; abra, faça tudo que precisa e feche.
   * Sempre trate exceções com `rollback()` quando fizer mudanças.

8. **Comportamento dos placeholders**

   * `%s` é o placeholder em PyMySQL (independente do tipo do valor).
   * A ordem dos valores na tupla/lista deve corresponder à ordem das colunas no `VALUES`.

Pronto — seguindo esse fluxo você insere dados de forma segura, eficiente e evita SQL injection. Quer um `script` compacto pronto para colar no projeto?
