Aqui está a explicação **simplificada do login e logout no Django** em **passo a passo**:

---

## **1️⃣ Criar um formulário reutilizável (partial)**

1. Criar um arquivo `user_form.html` em `templates/contact/partials/`.
2. Colar o HTML do formulário de login/registro nele.
3. Incluir este partial nos templates usando:

```django
{% include 'contact/partials/_user_form.html' %}
```

---

## **2️⃣ Criar a view de login**

1. Importar o formulário de autenticação do Django:

```python
from django.contrib.auth.forms import AuthenticationForm
from django.contrib import auth, messages
from django.shortcuts import render, redirect
```

2. Criar a função de login:

```python
def login_view(request):
    if request.method == "POST":
        form = AuthenticationForm(request, data=request.POST)
        if form.is_valid():
            user = form.get_user()  # pega o usuário autenticável
            auth.login(request, user)  # loga o usuário
            messages.success(request, "Logado com sucesso")
            return redirect('index')  # redireciona após login
        else:
            messages.error(request, "Login inválido")
    else:
        form = AuthenticationForm()
    
    return render(request, 'contact/login.html', {'form': form})
```

---

## **3️⃣ Criar a view de logout**

```python
def logout_view(request):
    auth.logout(request)  # desloga o usuário
    return redirect('login')  # redireciona para página de login
```

---

## **4️⃣ Configurar URLs**

```python
from django.urls import path
from .views import login_view, logout_view

urlpatterns = [
    path('user/login/', login_view, name='login'),
    path('user/logout/', logout_view, name='logout'),
]
```

---

## **5️⃣ Template de login**

1. Mostrar formulário apenas se o usuário **não estiver logado**:

```django
{% if user.is_authenticated %}
  Você já está logado como {{ user.username }}.
  <a href="{% url 'logout' %}">Sair</a>
{% else %}
  {% include 'contact/partials/_user_form.html' %}
{% endif %}
```

2. Exibir mensagens de sucesso ou erro usando Flash Messages (como na aula anterior):

```django
{% if messages %}
  {% for message in messages %}
    <div class="message {{ message.tags }}">
      {{ message }}
    </div>
  {% endfor %}
{% endif %}
```

---

## **6️⃣ Funcionamento resumido**

* O **AuthenticationForm** valida se o usuário e senha estão corretos.
* O **auth.login()** efetivamente loga o usuário na sessão.
* O **auth.logout()** encerra a sessão do usuário.
* O **messages** envia feedback para o usuário (login bem-sucedido ou inválido).
* O template verifica `user.is_authenticated` para exibir o formulário ou uma mensagem de que o usuário já está logado.

---

Se você quiser, posso fazer um **diagrama visual de como login, logout e mensagens funcionam juntos** no Django, para facilitar ainda mais a compreensão. Quer que eu faça?
