# Passo a passo — compactar e descompactar com `zipfile` (Python)

## 1) Imports e caminhos

```python
from pathlib import Path
import zipfile
import shutil   # opcional: utilitário rápido
```

Defina onde estão os arquivos e o ZIP:

```python
dir_to_zip = Path("aula186_dir")           # pasta com arquivos a compactar
zip_path    = Path("aula186_compactado.zip")
extract_dir = Path("aula186_descompactado")
```

---

## 2) (Opcional) Criar pasta de exemplo e arquivos

```python
dir_to_zip.mkdir(exist_ok=True)
for i in range(10):
    (dir_to_zip / f"arquivo_{i}.txt").write_text(f"Conteúdo do arquivo {i}\n", encoding="utf-8")
```

---

## 3) Criar um ZIP (modo recursivo, preservando estrutura relativa)

```python
with zipfile.ZipFile(zip_path, "w", compression=zipfile.ZIP_DEFLATED) as z:
    for p in dir_to_zip.rglob("*"):
        if p.is_file():
            # arcname = caminho interno no zip (relativo à pasta que zipamos)
            z.write(p, arcname=p.relative_to(dir_to_zip))
```

**Explicação:** `arcname` evita gravar caminhos absolutos no ZIP e mantém só a estrutura interna da pasta.

---

## 4) Ver conteúdo do ZIP

```python
with zipfile.ZipFile(zip_path, "r") as z:
    print(z.namelist())        # lista de nomes no zip
    for info in z.infolist():
        print(info.filename, info.file_size)
```

---

## 5) Descompactar tudo

```python
extract_dir.mkdir(exist_ok=True)
with zipfile.ZipFile(zip_path, "r") as z:
    z.extractall(extract_dir)
```

Ou extrair um único arquivo:

```python
with zipfile.ZipFile(zip_path, "r") as z:
    z.extract("subpasta/arquivo_3.txt", path=extract_dir)
```

---

## 6) Adicionar arquivos a um ZIP já existente

```python
with zipfile.ZipFile(zip_path, "a", compression=zipfile.ZIP_DEFLATED) as z:
    z.write("algum_arquivo_extra.txt", arcname="novo_nome_no_zip.txt")
```

---

## 7) Apagar arquivos/pastas (cuidado — operação destrutiva)

```python
# apagar ZIP
if zip_path.exists():
    zip_path.unlink()

# apagar pasta descompactada inteira
shutil.rmtree(extract_dir, ignore_errors=True)
```

> **Atenção:** `unlink()` e `shutil.rmtree()` removem permanentemente. Use só quando tiver certeza.

---

## 8) Método mais simples (uma linha) — `shutil.make_archive`

```python
# cria "aula186_compactado.zip" a partir de dir_to_zip (rápido)
shutil.make_archive("aula186_compactado", "zip", root_dir=dir_to_zip)
```

Esse cria um ZIP com tudo dentro de `dir_to_zip` (não precisa iterar).

---

## Dicas finais

* Use `ZIP_DEFLATED` (requer `zlib`, normalmente disponível) para compressão; `"w"` reescreve o ZIP, `"a"` adiciona.
* `arcname=p.relative_to(dir_to_zip)` mantém a estrutura interna e evita caminhos absolutos dentro do ZIP.
* Teste em uma pasta de exemplo antes de rodar em dados importantes.
* `shutil.make_archive` é a forma mais rápida quando não precisa de controle fino.

Se quiser, eu te mando um **script completo** de exemplo pronto para executar — quer que eu gere?
